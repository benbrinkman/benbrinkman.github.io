<!DOCTYPE html>
<html>
    <head>
        <title>Bengeons &amp; Dragons</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <link rel="stylesheet" type="text/css" href="CreatureChecker.css">
        <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@0,500;1,100&display=swap" rel="stylesheet">
    </head>
    <body>
        <div id="header">
            <h1>Welcome to the Bengeon</h1>
            <h2>Ben's Dungeons &amp; Dragons lists and things</h2>
        </div>
        <div id='content'>
            <table>
                <tr>
                    <th class='skinny'></th>
                    <th>Strength</th>
                    <th>Dexterity</th>
                    <th>Constitution</th>
                    <th>Intelligence</th>
                    <th>Wisdom</th>
                    <th>Charisma</th>
                    <th class='skinny'></th>
                    <th># of Hit Dice</th>
                    <th>Size</th>
                    <th>CR</th>
                </tr>
                <tr class='InputRow'>
                    <th class='skinny'>Score</th>
                    <td><input type="number" id="STR" ></td>
                    <td><input type="number" id="DEX" ></td>
                    <td><input type="number" id="CON" ></td>
                    <td><input type="number" id="INT" ></td>
                    <td><input type="number" id="WIS" ></td>
                    <td><input type="number" id="CHA" ></td>
                    <td class='skinny'></td>
                    <td><input type="number" id="HitDice" ></td>
                    <td><input type="text" id="Size" readonly></td>
                    <td><input type="text" id="CR" readonly></td>
                </tr>
                <tr class='InputRow'>
                    <th class='skinny'></th>
                    <td><input type="range" id="STRSlider" min="0" max="30" value="10" ></td>
                    <td><input type="range" id="DEXSlider"  min="0" max="30" value="10" ></td>
                    <td><input type="range" id="CONSlider"  min="0" max="30" value="10" ></td>
                    <td><input type="range" id="INTSlider"  min="0" max="30" value="10" ></td>
                    <td><input type="range" id="WISSlider"  min="0" max="30" value="10" ></td>
                    <td><input type="range" id="CHASlider"  min="0" max="30" value="10" ></td>
                    <td class='skinny'></td>
                    <td><input type="range" id="HitDiceSlider" id="CHASlider"  min="1" max="30" value="1" ></td>
                    <td><input type="range" id="SizeSlider" min="0" max="5" value="2"></td>
                    <td><input type="range" id="CRSlider" min="-3" max="30" value="2"></td>
                </tr>
            </table>
            <table id="output">
                <tr>
                    <th class="headerCell"></th>
                    <th>Strength</th>
                    <th>Dexterity</th>
                    <th>Constitution</th>
                    <th>Intellegence</th>
                    <th>Wisdom</th>
                    <th>Charisma</th>
                    <td class='skinny'></td>
                    <th class="headerCell">AC (Unarmored)</th>
                    <td id='ACout'></td>
                </tr>
                <tr>
                    <th class="headerCell">Modifier</th>
                    <td id='STRmodout'></td>
                    <td id='DEXmodout'></td>
                    <td id='CONmodout'></td>
                    <td id='INTmodout'></td>
                    <td id='WISmodout'></td>
                    <td id='CHAmodout'></td>
                    <td class='skinny'></td>
                    <th class="headerCell">Hit Points</th>
                    <td id='HPout'></td>
                </tr>
                <tr>
                    <th class="headerCell">Modifier (Proficient)</th>
                    <td id='STRmodproout'></td>
                    <td id='DEXmodproout'></td>
                    <td id='CONmodproout'></td>
                    <td id='INTmodproout'></td>
                    <td id='WISmodproout'></td>
                    <td id='CHAmodproout'></td>
                    <td class='skinny'></td>
                    <th class="headerCell">Proficiency</th>
                    <td id='PROout'></td>
                </tr>
                <tr>
                    <th class="headerCell">Modifier (Expertise)</th>
                    <td id='STRmodexpout'></td>
                    <td id='DEXmodexpout'></td>
                    <td id='CONmodexpout'></td>
                    <td id='INTmodexpout'></td>
                    <td id='WISmodexpout'></td>
                    <td id='CHAmodexpout'></td>
                    <td class='skinny'></td>
                    <th class="headerCell">Passive Perception*</th>
                    <td id='PPout'></td>
                </tr>
                <tr>
                    <th>Saving Throw DC</th>
                    <td id='STRsave'></td>
                    <td id='DEXsave'></td>
                    <td id='CONsave'></td>
                    <td id='INTsave'></td>
                    <td id='WISsave'></td>
                    <td id='CHAsave'></td>
                </tr>
                <tr>
                    <th>Attack / Damage</th>
                    <td id='STRatk'></td>
                    <td id='DEXatk'></td>
                    <td id='CONatk'></td>
                    <td id='INTatk'></td>
                    <td id='WISatk'></td>
                    <td id='CHAatk'></td>
                </tr>
            </table>
            <table id="avg">
                <tr>
                    <th># of Dice</th>
                    <th>Dice Size</th>
                    <th>Modifier</th>
                </tr>
                <tr>
                    <td> <input id='NumDiceavg' type="number"></td>
                    <td><input id='DiceSizeavg' type="number"></td>
                    <td><input id='Modavg' type="number"></td>
                </tr>
                <tr>
                    <td> <input  id='NumDiceavgSlider' type="range" min=1 max=12 value=1></td>
                    <td><input id='DiceSizeavgSlider' type="range" min=4 max=12 step=2 value=4></td>
                    <td><input id='ModavgSlider' type="range" min=-10 max=10 value=0></td>
                </tr>
                <tr>
                    <td id="avgout"></td>
                </tr>
            </table>
        </div>
    
        <script>
            var sizes = ["Tiny","Small","Medium","Large","Huge","Gargantuan"];
            var sizeValue = [4,6,8,10,12,20];
            var CRlist = ['0',"1/8","1/4","1/2",'1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30'];
            var Proflist=[2,2,2,2,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9];
            var Scores=["STR","DEX","CON","INT","WIS","CHA"];
            
            
            var Prof;
            var Mod = [0,0,0,0,0,0];
            var HP;
            var NumHitDice;
            
            UpdateSlider("STR");
            UpdateSlider("DEX");
            UpdateSlider("CON");
            UpdateSlider("INT");
            UpdateSlider("WIS");
            UpdateSlider("CHA");
            UpdateSlider("HitDice");
            UpdateSlider("Size");
            UpdateSlider("CR");
            UpdateSlider("NumDiceavg");
            UpdateSlider("DiceSizeavg");
            UpdateSlider("Modavg");

            $(document).on('input', function() {
                
                if(event.target.type == 'range'){
                    UpdateSlider(event.target.id.slice(0, -6));            
                }else{
                    SetSlider(event.target.id);            
                }
            });
            
            function SetSlider(_val){
                console.log(_val);
                $("#"+_val+"Slider").val($("#"+_val).val());

            }
            
            function UpdateSlider(_val){
                if(_val == "Size"){
                    $("#Size").val(sizes[$("#SizeSlider").val()]);
                }
                else if(_val == "CR"){
                    ValidateCR();
                }
//                else if(_val == "NumDiceavg"){
//                    
//                }
                else{
                    $("#"+_val).val($("#"+_val+"Slider").val());
                }
                Proficiency();
                Modifiers();
                Health();
                CalcAvg();
            }
            
            function CalcAvg(){
                var _num = $("#NumDiceavg").val();
                var _die = $("#DiceSizeavg").val();
                var _mod = parseFloat($("#Modavg").val());
                var _symbol = (_mod > -1) ? "+":"";

                
                var _avg = Math.floor((_num*((_die/2)+0.5))+_mod);              
                var _result = _num+"d"+_die+_symbol+_mod+" = "+_avg;
                
                $('#avgout').html(_result);
            }
            function ValidateCR(){
                var CR = $("#CRSlider").val()
                $("#CR").val(CR);
                if(CR == -3){
                    $("#CR").val(0);
                }
                else if(CR == -2){
                    $("#CR").val("1/8");
                }
                else if(CR == -1){
                    $("#CR").val("1/4");
                }
                else if(CR == 0){
                    $("#CR").val("1/2");
                }
            }          
            function Proficiency(){
                Prof = Proflist[$.inArray($("#CR").val(), CRlist)]
                $("#PROout").html(Prof);
                ModProf();
            }
            function Modifiers(){
                for(let i = 0; i < Mod.length; i++){
                    Mod[i] = Math.floor(($("#"+Scores[i]).val()-10)/2);
                    $("#"+Scores[i]+"modout").html((Mod[i]<1?"":"+")+Mod[i]);
                }
                ModProf();
                $("#ACout").html(10+Mod[1]);
                $("#PPout").html(10+Mod[4]);

            }
            function ModProf(){
                for(let i = 0; i < Mod.length; i++){
                    var _val = Prof + Mod[i];
                    $("#"+Scores[i]+"modproout").html((_val<1?"":"+")+_val);
                    
                    $("#"+Scores[i]+"atk").html((_val<1?"":"+")+_val +" / "+(Mod[i]<1?"":"+")+Mod[i]);
                    
                    
                    _val += Prof;
                    $("#"+Scores[i]+"modexpout").html((_val<1?"":"+")+_val);
                    _val = 8+Mod[i]+Prof;
                    $("#"+Scores[i]+"save").html("DC "+_val);
                }
            }
            function Health(){
                var hd = $("#HitDice").val();
                var die = sizeValue[$.inArray($("#Size").val(), sizes)];
                var add = Mod[2]*hd;
                
                var _hp = Math.floor((hd*((die/2)+0.5))+add);
                
                
                $("#HPout").html(_hp +" ("+hd+"d"+die+" + "+add+")");
            }
            

        </script>
    </body>

</html>